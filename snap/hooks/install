#!/bin/sh -e

logger "*** starting install hook ***"

### variables ###
APPDIR="${SNAP_DATA}/App"
LOGDIR="${SNAP_DATA}/Logs"
CONFIGDIR="${SNAP_COMMON}/Config"
TAGDIR="${SNAP_DATA}/Data/TagStateLog"
TAGSUMDIR="${SNAP_DATA}/Data/TagReadSummaryLog"


# set snap set variables 
snapctl set url='ws://master-rms.radiantrfid.com/Rms/'
snapctl set log-level='Warn'


#### main ####
# setup our working directory
mkdir -p $APPDIR
mkdir -p $LOGDIR
mkdir -p $CONFIGDIR
mkdir -p $TAGDIR
mkdir -p $TAGSUMDIR
 
# copy ble controller to the services writable location
cd ${APPDIR}
cp ${SNAP}/bin/radiant-ble-controller ${APPDIR}/
chmod +x ${APPDIR}/radiant-ble-controller
#ls -la ${APPDIR} 2>&1 | logger &

# check to see if the default.config already exist
if [ ! -f ${CONFIGDIR}/default.config ]; then
  logger "did not find default.config at this location ${CONFIGDIR}"
  logger "copying it from snap"
  cp ${SNAP}/misc-files/default.config ${CONFIGDIR}/
fi

### legacy: remove once code is updated ###
# copy the firmware-config.ini to the services writable location
cp ${SNAP}/misc-files/firmware-config.ini ${APPDIR}/
